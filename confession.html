<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GDU Confession</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif;}
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #0072ff, #00c6ff);
      display: flex; flex-direction: column; align-items:center; padding:20px;
      color:#fff;
    }

    /* Header */
    .header {
      width: 100%;
      max-width: 700px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .header h1 { font-size:1.8rem; }
    .header-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn {
      padding: 10px 20px;
      border-radius: 12px;
      border: none;
      background: rgba(255,255,255,0.2);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
      white-space: nowrap;
    }
    .btn:hover { background: rgba(255,255,255,0.35); }

    /* Form ƒëƒÉng b√†i m·ªõi */
    .new-post {
      width: 100%;
      max-width: 700px;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }
    .new-post h3 { font-size:1.3rem; margin-bottom:10px; }
    .new-post textarea {
      width:100%;
      padding:12px;
      border-radius:12px;
      border:none;
      background:rgba(255,255,255,0.1);
      color:#fff;
      resize:none;
      min-height:80px;
      outline:none;
    }

    /* Upload ·∫£nh */
    #imageUploadBox {
      padding:20px;
      border:2px dashed rgba(255,255,255,0.5);
      border-radius:15px;
      text-align:center;
      cursor:pointer;
      transition:0.3s;
      position:relative;
    }
    #imageUploadBox:hover { background:rgba(255,255,255,0.1); border-color:#fff; }
    #imageUploadBox img {
      max-width:100%;
      max-height:250px;
      margin-top:10px;
      border-radius:15px;
      box-shadow:0 5px 15px rgba(0,0,0,0.2);
      object-fit:cover;
    }
    #uploadText { display:block; }

    /* Danh s√°ch posts */
    .posts { width:100%; max-width:700px; display:flex; flex-direction:column; gap:15px; }
    .post { background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius:16px; padding:15px; }
    .post-header { display:flex; justify-content:space-between; margin-bottom:10px; font-weight:600; }
    .post-content { margin-bottom:10px; white-space:pre-wrap; }
    .post img { max-width:100%; border-radius:12px; margin-top:10px; box-shadow:0 5px 15px rgba(0,0,0,0.2); }
    .post-actions { display:flex; gap:10px; margin-bottom:10px; }
    .post-actions button { background:rgba(255,255,255,0.1); border:none; padding:6px 12px; border-radius:10px; cursor:pointer; transition:0.3s; color:#fff; }
    .post-actions button:hover { background:rgba(255,255,255,0.25); }

    /* Comment */
    .comments { margin-top:10px; display:flex; flex-direction:column; gap:5px; }
    .comment { background: rgba(255,255,255,0.1); padding:6px 10px; border-radius:10px; font-size:0.9rem; }
    .comment-form { display:flex; gap:10px; margin-top:5px; }
    .comment-form input {
      flex:1;
      padding:6px 10px;
      border-radius:10px;
      border:none;
      outline:none;
      background:rgba(255,255,255,0.1);
      color:#fff;
    }
    .comment-form button { padding:6px 12px; border-radius:10px; border:none; background:rgba(255,255,255,0.2); color:#fff; cursor:pointer; transition:0.3s; }
    .comment-form button:hover { background:rgba(255,255,255,0.35); }

    .credit { margin-top:40px; font-size:0.8rem; color:rgba(255,255,255,0.7);}

    /* Responsive */
    @media(max-width:480px){
      .header { flex-direction: column; align-items:flex-start; gap:10px; }
      .header h1 { font-size:1.5rem; }
      .header-buttons { width:100%; display:flex; justify-content:flex-start; gap:10px; }
      .btn { font-size:0.85rem; padding:8px 16px; }
      .new-post { padding:15px; }
      .new-post h3 { font-size:1.2rem; }
    }
  </style>
</head>
<body>

<div class="header">
  <h1>GDU Confession</h1>
  <div class="header-buttons">
    <button class="btn" onclick="window.location.href='index.html'">Trang ch·ªß</button>
    <button class="btn" id="logoutBtn">ƒêƒÉng xu·∫•t</button>
  </div>
</div>

<!-- Form ƒëƒÉng b√†i m·ªõi -->
<div class="new-post">
  <h3>ƒêƒÉng b√†i m·ªõi</h3>
  <textarea id="postContent" placeholder="B·∫°n ƒëang nghƒ© g√¨...?"></textarea>
  <div id="imageUploadBox">
    <input type="file" id="postImage" accept="image/*" hidden>
    <span id="uploadText">üì∑ Ch·ªçn ·∫¢nh</span>
    <img id="previewImage" src="" style="display:none;">
  </div>
  <button class="btn" id="postBtn">ƒêƒÉng</button>
</div>

<!-- Danh s√°ch confession -->
<div class="posts" id="postsContainer"></div>

<div class="credit">Vi·∫øt b·ªüi B·∫£o Long</div>

<script>
  // Ki·ªÉm tra login
  const currentUser = JSON.parse(localStorage.getItem('currentUser'));
  if(!currentUser || localStorage.getItem('loggedIn') !== 'true'){
    alert('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ v√†o trang n√†y!');
    window.location.href = 'login.html';
  }

  // Logout
  document.getElementById('logoutBtn').addEventListener('click', ()=>{
    localStorage.removeItem('loggedIn');
    localStorage.removeItem('currentUser');
    window.location.href='login.html';
  });

  // Upload ·∫£nh
  const imageUploadBox = document.getElementById('imageUploadBox');
  const postImageInput = document.getElementById('postImage');
  const previewImage = document.getElementById('previewImage');
  const uploadText = document.getElementById('uploadText');

  imageUploadBox.addEventListener('click', ()=> postImageInput.click());
  postImageInput.addEventListener('change', ()=> {
    const file = postImageInput.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = (e)=>{
        previewImage.src = e.target.result;
        previewImage.style.display = 'block';
        uploadText.style.display = 'none';
      }
      reader.readAsDataURL(file);
    } else {
      previewImage.style.display = 'none';
      uploadText.style.display = 'block';
    }
  });
  imageUploadBox.addEventListener('dragover', e=>{ e.preventDefault(); imageUploadBox.style.background='rgba(255,255,255,0.15)'; });
  imageUploadBox.addEventListener('dragleave', e=>{ e.preventDefault(); imageUploadBox.style.background='transparent'; });
  imageUploadBox.addEventListener('drop', e=>{
    e.preventDefault();
    const file = e.dataTransfer.files[0];
    if(file && file.type.startsWith('image/')){
      postImageInput.files = e.dataTransfer.files;
      const reader = new FileReader();
      reader.onload = (ev)=>{
        previewImage.src = ev.target.result;
        previewImage.style.display = 'block';
        uploadText.style.display = 'none';
      }
      reader.readAsDataURL(file);
    }
  });

  // Post b√†i
  const postBtn = document.getElementById('postBtn');
  const postsContainer = document.getElementById('postsContainer');

  function loadPosts(){
    const posts = JSON.parse(localStorage.getItem('posts')) || [];
    postsContainer.innerHTML = '';
    posts.reverse().forEach((p,i)=>{
      const div = document.createElement('div');
      div.classList.add('post');
      div.innerHTML = `
        <div class="post-header">${p.user}</div>
        <div class="post-content">${p.content}</div>
        ${p.image ? `<img src="${p.image}">` : ''}
        <div class="post-actions">
          <button data-id="${posts.length - 1 - i}" class="likeBtn">‚ù§Ô∏è ${p.likes.length}</button>
        </div>
        <div class="comments" id="comments-${posts.length - 1 - i}">
          ${(p.comments || []).map(c=>`<div class="comment"><b>${c.user}:</b> ${c.text}</div>`).join('')}
        </div>
        <div class="comment-form">
          <input type="text" placeholder="Vi·∫øt b√¨nh lu·∫≠n..." data-id="${posts.length - 1 - i}">
          <button data-id="${posts.length - 1 - i}">B√¨nh lu·∫≠n</button>
        </div>
      `;
      postsContainer.appendChild(div);
    });

    // Like button
    document.querySelectorAll('.likeBtn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const idx = btn.getAttribute('data-id');
        let posts = JSON.parse(localStorage.getItem('posts')) || [];
        if(!posts[idx].likes.includes(currentUser.name)){
          posts[idx].likes.push(currentUser.name);
          localStorage.setItem('posts', JSON.stringify(posts));
          loadPosts();
        } else {
          alert('B·∫°n ƒë√£ like b√†i n√†y r·ªìi!');
        }
      });
    });

    // Comment button
    document.querySelectorAll('.comment-form button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const idx = btn.getAttribute('data-id');
        const input = document.querySelector(`.comment-form input[data-id='${idx}']`);
        const text = input.value.trim();
        if(text){
          let posts = JSON.parse(localStorage.getItem('posts')) || [];
          if(!posts[idx].comments) posts[idx].comments = [];
          posts[idx].comments.push({ user: currentUser.name, text });
          localStorage.setItem('posts', JSON.stringify(posts));
          input.value='';
          loadPosts();
        }
      });
    });
  }

  postBtn.addEventListener('click', ()=>{
    const content = document.getElementById('postContent').value.trim();
    const image = previewImage.src || '';
    if(!content && !postImageInput.files[0]){
      alert('Vui l√≤ng nh·∫≠p n·ªôi dung ho·∫∑c ch·ªçn ·∫£nh!');
      return;
    }
    const posts = JSON.parse(localStorage.getItem('posts')) || [];
    posts.push({ user: currentUser.name, content, image: image && postImageInput.files[0] ? image : '', likes: [], comments: [] });
    localStorage.setItem('posts', JSON.stringify(posts));

    // Reset form
    document.getElementById('postContent').value = '';
    postImageInput.value = '';
    previewImage.src='';
    previewImage.style.display='none';
    uploadText.style.display='block';
    loadPosts();
  });

  loadPosts();
</script>

</body>
</html>

